name: FFmpeg Android ARMv7

on:
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout
      uses: actions/checkout@v4

    - name: Install build dependencies
      run: |
        sudo apt update
        sudo apt install -y yasm nasm autoconf automake libtool pkg-config

    - name: Download Android NDK r21e
      run: |
        wget https://dl.google.com/android/repository/android-ndk-r21e-linux-x86_64.zip
        unzip android-ndk-r21e-linux-x86_64.zip

    - name: Clone FFmpeg 3.4.13
      run: |
        git clone https://github.com/FFmpeg/FFmpeg.git
        cd FFmpeg
        git checkout n3.4.13

    - name: Build libavcodec (armeabi-v7a)
      run: |
        export NDK=$PWD/android-ndk-r21e
        export TOOLCHAIN=$NDK/toolchains/llvm/prebuilt/linux-x86_64
        export CC=$TOOLCHAIN/bin/armv7
